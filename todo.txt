next release:
- caution tape on doors leading to (otherwise unforeseeable) risk of death/softlock?
- restore tourian blue hoppers to vanilla

priority:
- from alphanimal: When "disable music" is on, could you just make it load vanilla audio channels, so some sound effects don't get messed up
- controller config special settings (moonwalk) customization
- randomized title screen
- enhancements to momentum conservation patch
  - remove need to be holding dash or to be in spin
  - reset speed boost counter whenever momentum conservation comes into play, to avoid making it too easy to get blue
  - retain speed when turning around with spin?
  - on ground, retain horizontal speed when unmorphing
    - by pressing up (or jump, if spring ball not equipped) while holding forward
  - in air, retain horizontal speed when soft unmorphing while holding forward
- door color randomization
- set up a more robust way for users to save & select presets
- move input ROM off Generate page (and into separate dialogue that only shows on first use).
- convert tech/strat AVIs to WebM & WebP (using ffmpeg CLI)
  - WebM/VP9 for full playback using HTML5 <video>
  - WebP for thumbnails
  - use image-rendering: pixelated
- add CF health refill to logic
  - tricky CF at ammo refill stations
- logic: add some 3-room shinecharge strats to logic (ones that can work with existing schema)
- add notable for underwater canGateGlitch (Very Hard)?
- remove old-format farms and refills from sm-json-data?
- make hub requirements consistent with new farm approach?
  - actually probably don't need to define hub rooms anymore:
      - just check for ability to refill each resource type from the start location and get back
- logic pages (tech/room/strat): add way to fill out items/flags/resources/obstacles to simulate logic
- take another look at boss fights
  - create table to show in help button, to make boss logic more transparent (in addition to showing formulas)
  - 5 Super phantoon fight probably needs more requirements than it currently has.
- add objectives:
  - Larvas: 4 special items (replacing missiles)
  - Random
- investigate panic during spoiler log construction:
  - RUST_BACKTRACE=1 time cargo run --bin maprando-cli -- --map ../maps/session-2022-06-03T17:19:29.727911.pkl-bk30-subarea-balance-2/1000001.json --item-placement-seed 3 --input-rom ~/Downloads/Super\ Metroid\ \(JU\)\ \[\!\].smc --output-rom ~/Downloads/testrom.smc
- investigate resource_multiplier bug that happened in Osse's seed with resource_multiplier=8:
  - https://maprando.com/seed/isnUf9YjIhvW-BJFrvFuyw/data/visualizer/index.html
  - (was from enemykill not using multiplier)
- Fix bug with cross-room jump?:
  - spoiler shows no logical path out of draygon until later than expected:
    https://maprando.com/seed/O4j4-NDrcwckyTtJMVqxdw/data/visualizer/index.html
- Slow progression item placement bug?:
  - supers placed on same step as Screw, although Missiles still available as filler:
    - https://maprando.com/seed/HwuYziIJUh-sCUM0YCAPRA/data/visualizer/index.html
  - possibly related: issue where filler items are re-randomized when trying new key item.
    - maybe re-randomizing is ok, but on success it should try replacing key item with Missile (instead of having Missile be first key item tried)
- fix quick-reload on last frame of pause/unpause
- check if reloading from bottom/top of elevator works correctly (not skips back a save)
- do something about screen shaking during samus appears (in start location: rising tide, amphitheatre)
  - maybe customization option to get rid of shaking in general?
- new map pool
  - bosses not cleared unless "enemies cleared" option is enabled
- handle canShinesparkWithReserve in randomizer (and remove it from being ignored)
- incrementally build graph traversal with increasing difficulty tiers, acquiring flags in the process.
  - will allow better accounting of the difficulty of boss fights in forced mode
  - should be faster too
  - improved spoiler log route
- show objective progress in pause menu (also zebes awake, phantoon defeated)?
  - or maybe just make objective X's fade on map (if we do faded item dots)
- help buttons for rest of settings (e.g. explain boss proficiency calculations)
- logic simulator
- get rid of symlink for sm-json-data
- temporarily disable comeInWithGMode strats through sand since this will not be correct with how it
  is currently set up (since there is no way to go up through sand)

later:
- add animated GIFs on room/tech/strat pages for notable strats.
- maybe overhaul how randomization/customization phases work: run customization on client (with Rust WebAssembly?)
  - make it so that customization can use matching version from when the seed was generated
  - include more options for customization
  - ROM won't need to be provided for generation, only customization
- map improvements
  - fix little pause menu palette issue at top of equipment screen (green where gray should be)
- handle runways with conditional physics (Volcano Room, Amphitheatre, East Pants Room)
- check why Tourian Escape Room 1 runway isn't allowing Speedball strat into Wrecked Ship Main Shaft (on Expert)
- remove invisible solid tile in Tourian Escape Room 1, above transition
- maybe move enhanced Samus controls into separate option (instead of Max QoL)?
- enforce tech dependencies:
  - e.g. enabling "canPreciseWalljump" should enable dependency "canWalljump"
  - disabling "canWalljump" should disable dependent "canPreciseWalljump"
- gravity seems to provide 50% heat reduction on elevator ride? (Remove this.)
   - https://clips.twitch.tv/RepleteShyManateeTBTacoLeft-Ip5vQynrc0SQYQUj
   - maybe during acid chozo drain too?
- change how cross-room logic works?:
  - unify cross-room strats to go under links, with annotations on the cross-room state (in new strat properties)
  - replaces "initiateRemotely", allows obstacles and one-way cross-room paths to be handled properly
- minimal items mode:
  - could go in pending "Wild" item progression preset (along with option to allow items to be potentially required to be used in their return path)
  - taking into account objectives & MB requirements, replace unneeded items with nothings (e.g. empty Missile container)
  - keep item dots as they would have been (mixture of different possible types)
  - there's no longer a guarantee that every room can be eventually reachable
  - maybe allow customizabilty of which items can be removed:
    - some people might still want to get certain items (e.g. beams)
- consider "friendly reserve tank behavior" QoL option in max:
  - manually refilling to full doesn't empty the remaining reserves (requested by zero318)
  - i-frames don't expire during reserve? (though this would break double-damage boost strats)
  - no heat damage during reserve refill
  - maybe?:
    - energy recharge stations also refill reserve energy
    - collecting etank also refills reserves?
  - (not part of QoL:) fix crash when pausing on frame when auto reserve triggers 
  - See existing patch for some of these: https://metroidconstruction.com/resource.php?id=418
- consider bot-friendly API
- "wild" item progression mode, where new item may be required to be used for the return path.
- consider idea from selicre: "what if there was a mode in which walljumps could be unlocked by visiting etecoons (and shinesparking by visiting dachora)?"
- custom demos
- include a check that the client and server are matching versions and give a more meaningful error when they aren't
- look into botwoon requirements: 
  https://maprando.com/seed/-yvSvwjFlrfJN1NRxDi-Jw/data/visualizer/index.html
- unlock all gray doors during escape (eventually only when "enemies cleared during escape" is enabled)
  - e.g. metal pirates
- press X to fast forward during credits?
- QoL option for save station fast travel (in Max)?
- investigate problem when using quick reload (L+R+Select+Start) while unpausing with 0 energy.
- investigate: ridley gray door closed when reserve triggered (in sapphron seed)
- on seed page: for each tier, show selected tech/strats or deselected tech/strat, whichever is a shorter list
- fix escape timer tech mapping to use reverse Amphitheatre notable for can_acid_dive
- model improvement:
  - try using localized output: use token that room is placed in, instead of applying attention across all tokens
  - try nvidia transformer engine
  - increase model size, probably decrease pass factor and buffer size
  - try again using action values, to reduce the amount of computation needed
- when tile above Samus gets explored (in speedways) make it get revealed too
- fix missing Samus tile in Bomb message box (issue with map tile expansion patch)
- add logic override for strat to run under tourian blue hoppers from left (except with ultra-low QoL)
- fix: arrow map tile down to toilet doesn't get revealed (when it crosses areas)?
- logic: killing 3 musketeers with ice should require patience?
- fix toilet tile in botwoon's hallway with "vanilla map" option.
- handle 3-room shinesparks
  - at least basic case where using two-room combined runway to get a charge then jump into a 3rd room
    - should be representable with canLeaveCharged having a canComeInCharged requirement (180 frames)
  - in trickier cases, the frames in canLeaveCharged could depend on frames remaining in canComeInCharged
    - we could add a field in canComeInCharged "relativeFrameRemaining" for this
- make kraid camera act normal when entering from left
  - same thing with spore spawn entering from bottom
- handle (steep) slopes in runway length calculations
- 10 super botwoon should be possible in Expert (and 30 missile in Insane?)
- possibly adjust some of the transition marker letters:
  - make the right part of the N thicker (possibly make it 7 pixels wide?)
  - make M and W be 7 pixels wide. 
    - Mirror them to put the gap in the correct place?
    - but if it has tiles on both the left & right, what do we do?
       - keep it 6 pixels?
- maybe make Mother Brain Room reveal all its tiles (and maybe explore them too? but probably not), to be more consistent with the other boss rooms
   - on the other hand, what about minibosses and other objectives? maybe just leave all this alone?
- fix save animation colors (area-themed color looks a little bad?)
- logic: metroid tank damage may need to be higher without some tech (multiplier doesn't apply)
- fix how spoiler map sometimes won't show escape route
- see if it is possible to prevent song changes from messing up enemy behavior
- fix problem with disappearing typewriter text when pausing as escape sequence starts
- Add override for Tourian Hopper run under strat from left to top (imyt strat)
- add a tip that you can share a seed using the URL.
- logic (maybe): moondance (bowling alley), tas dance (green brin shaft)
- make graph traversals faster by using previous step for initial local states (probably not worth it?):
  - we'd have to do a full graph traversal to get spoiler route as a separate step, to avoid getting weird long paths
- in sm-json-data: use Ship refill in G-mode strats:
  - for strats that enter G-mode into Landing Site, use it, and then go back out still in G-mode
- replace Botwoon Hallway portion of Toilet level data with something more neutral
   - also remove the enemies from the Botwoon Hallway part
- fix gray door after mother brain when entering baby kraid (& metal pirates, boss rooms, etc.?)
- add patch for handling crashes? (to display the stack & registers)
- if possible, debug crash in Mt. Everest from Scottycro42 (https://clips.twitch.tv/DarlingSavageDogeMcaT-zgV9PF33MiawTpL2)
- oats seed Apr 1:
 - main street shinespark energy
 - kronic boost heatframes
 - metal pirates hitbox doesn't need plasma
- take double-hits into account correctly with reserve energy.
- check if pants room internal door connects correctly in logic
- add option (enabled on Challenge) to not treat tanks as filler items anymore after giving Varia (including the step where giving Varia)
  - maybe more general option to postpone unneeded filler items aside from missiles
- spoiler visualizer improvements (see GitHub issue)
- fix panic that is occasionally happening:
  thread 'actix-rt|system:0|arbiter:0' panicked at 'assertion failed: num_key_items_to_place >= 1', src/randomize.rs:671:9
- find some way to have forced mode take into account difficulty of defeating bosses (and other flags)
  - for each flag, identify its tier using just the flag edge (not redoing a full graph traversal)
  - then for the item placement, have the graph traversal treat that flag not as free but as whatever difficulty it was.
- consider putting back the save confirmation.
- fix graphics in door transitions?
- fix (sometimes?) glitched right door in GT. X-Ray showed a plasma beam inside it
- adjust elevator heatFrames when fast elevators enabled
- make quick reload work while in pause menu?
- refine cross room shinesparks:
    - slopes
- consider overhauling how cross-room logic is encoded:
  - canComeInCharged should be in a special part of the "node" (symmetric to "canLeaveCharged"), not in "links"
  - same thing for adjacentRunway
  - since "can" sounds like a tech, maybe we should rename these "enterCharged", "enterWithRunway", etc. (later we can have
    "enterWithSpeedball" and other things), and symmetrically, "exitCharged", "exitWithSpeedball", etc.
  - This is cleaner, reduces need for preprocessing, and would cut out the possibility of expressing invalid things
    like requiring multiple adjacentRunway from different nodes in the same strat.
- improve slow-progression logic: allow item progression by unlocking way back
  - don't immediately place filler items at one-way reachable locations
  - instead check that when a key item is placed at a previously one-way-reachable location, the item would not have provided
    a way back at an earlier step?
- fix spoiler log for reverse paths using shinesparks, G-mode, etc.
- fix bug where suit color does not change when changing suits while taking damage (e.g. lava dive)?
- fix bug where music is wrong after quick reload (even after going to next room).
- clean up the web service, to reduce the amount of boilerplate plumbing settings around.
- figure out why some rooms are dark (some FX other than palette FX?)
- fixes/improvements to area palettes:
  - add back palette FX glows using correct palettes.
  - fix palette in Crocomire cutscene when wall collapses
  - fix cutscene between MB1 and MB2
  - fix background during Ridley fight
- During escape, block backward path using room setup ASM instead of door ASM (so it can still work after leaving room another way)
  - when going into room with no doorcap (e.g. escape room 1, glass tunnel) fix how gray door appears:
    - shift to the right a tile.
    - maybe use wall PLM instead of gray door
  - or, possibly better idea: don't spawn a gray door or wall, just have it take you into post-MB-fight state of MB room
    (like escape auto-save does).
- make separate option for patching out major glitches?
  - include GT code, Spacetime beam (currently patched out)
  - make OOB cause instant death?
  - others
- Add way to export settings from seed page (and export/import on main page).
- Possible model refinment: spread out placement of single-tile, single-door rooms to help balancing of saves & refills.
- Better validation/error-handling of web service
  - push more validation into client
- Add note to strat in Post-Crocomire farming room to get to top-left with HiJump
  (run on platform enemy and jump)
- Use separate worker pool to run randomization (to avoid blocking web requests)
- Rust cleanup:
    - Use `serde_json` instead of `json` crate for loading sm-json-data.
    - Clean up error handling: get rid of a bunch of remaining unwrap()'s, etc.
- Make Gravity-only Samus palette different from Gravity+Varia.
    - Figure out how this can work with custom sprites.
- Consider rejecting cases where the set of bireachable item locations grows too slow or too fast.
- fix color of reserve tank energy in equipment menu (got messed up by colored arrows)
- move GFX colors:
  - Morph Ball room (blue brinstar), tileset 7:
    - [0x31, 0x32, 0x33] -> [0x38, 0x39, 0x3A]
- fix tiny bug: when bottom-left door of landing site is an area transition, the arrow shows up from the beginning
  of the game (due to running the door ASM while loading the game)
- fix internal checksum in output ROM
- fix suit graphics not showing after getting suit (consequence of skipping animation)?
- have forced mode take into account return path?
  - probably bad idea, because returning may not be required (before getting another item that makes it easier).
- Do something about Crocomire funny map behavior (especially when entering from left door)?


maybe someday?:
- minimizer mode? (select rooms to include randomly, hand-picked, and/or user-selected)
- make map rando for other hacks (e.g. project base, subversion?)
  - would be a lot of work. we could invite others to help implement the logic
- multitroid support


rejected ideas (probably):
- set boss flag immediately when boss dies.
- balance boss distribution (one boss per area, corresponding to vanilla?)
- consider moving the MB barriers to the right one tile (or two?), to make them interfere less with ice zeb skip.
- Option for anti-softlock patches (e.g. in Moat, Early Supers, etc.)?
  - disable acid trigger in Leodox room?


notes on tileset palette stuff:
  - tileset table: $8FE6A2  (will need to move to location with more space)
  - tileset pointers: $8FE7A7  (will need to update to point into new tileset table)
  - current tileset (one row of tileset table):
    - $07C0: Tileset tile table pointer
    - $07C3: Tileset tiles pointer
    - $07C6: Tileset palette pointer
  - reference to tileset pointers: $82:DF02 (LDA $E7A7, y)
- tileset data decompressed to RAM:
    - tile table: $7E:A800  (at $82:E856)
       - CRE tile table: $7E:A000  (at $82:E843)
          - from $B9A09D
    - tiles: $7E:2000  (at $82:E42E)
      - VRAM $0000 (at $82:E7B4)
    - palette: $7E:C200  (at $82:E43F)
 - palette FX loading: https://patrickjohnston.org/bank/89#fAB82
- MB lights back on: https://patrickjohnston.org/bank/AD#fF24B

notes on marking elevator tiles:
- boss tile marking: $90:A7E2


title graphics notes:
  - title
     - sprites GFX: $95:80D8 ("Super Metroid" graphics, "Nintendo", etc.):
         - bank pointer to sprite GFX at $8B:9295
         - word pointer to sprite GFX at $8B:9299
         - copied to VRAM $6000..7FFF
     - spritemap: $8C:879D (also $8C:833D but this is unused)?
         - free space at $8C:F760
         - (2-byte) pointer to spritemap: $8B:A0C5
         - Description of spritemap format: $A9:93EE
     - uses screen mode 7 during title
          - only BG layer is BG1 (as always for mode 7).
          - OAM base: VRAM 0xC000  (sprite GFX for "Super Metroid" title)
     - normally mode 1 elsewhere
  - title BG GFX: $94:E000 (0xA6000)
  - title BG tilemap: $96:FC04 (0xB7C04)


- samus sprites notes:
  - tile graphics:
    - $92d94e: animation definition pointers (1 word per Samus pose), points to animation definition in bank $92
    - $92db48: animation definitions (target of pointers in table at $92d94e)
      - 4 bytes per animation frame
      - byte 0: top half, index into $92D91E
      - byte 1: top half, multiplied by 7 and added to index for byte 0 to get pointer to tile definition.
      - byte 2: bottom half, index into $92D938
      - byte 3: bottom half, multiplied by 7 and added to index for byte 2 to get pointer to tile definition.
      ; First byte indexes the top half tiles definitions pointer table ($D91E) for a pointer to a list of DMA entries that is indexed by the second byte
      ; Third byte indexes the bottom half tiles definitions pointer table ($D938) for a pointer to a list of DMA entries that is indexed by the fourth byte
    - $92cbee: tile definitions (DMA entries)
      - 7 bytes per animation frame:
        ; Samus tiles definition format:
        ;     aaaaaa nnnn NNNN
        ; where:
        ;     a: Source address (banks $9B - $9F)
        ;     n: Part 1 size, n = 0 means 10000h bytes are transferred
        ;     N: Part 2 size, N = 0 means no bytes are transferred
  - spritemaps:
    - $929263: spritemap table indices, top half (1 word per Samus pose), index into spritemap table at $92808D
    - $92945D: spritemap table indices, bottom half (1 word per Samus pose), index into spritemap table at $92808D
    - $92808D: spritemap table: 1 word for each animation frame, starting at index given above, pointing into spritemaps in bank $92 (at $929657)
    - $929657: spritemaps, in format described in PJ's bank logs at $A9:93EE:
      ; Spritemap format is roughly:
      ;     nnnn         ; Number of entries (2 bytes)
      ;     xxxx yy aatt ; Entry 0 (5 bytes)
      ;     ...          ; Entry 1...
      ; Where:
      ;     n = number of entries
      ;     x = X offset of sprite from centre
      ;     y = Y offset of sprite from centre
      ;     a = attributes
      ;     t = tile number

      ; More specifically, a spritemap entry is:
      ;     s000000xxxxxxxxx yyyyyyyy YXppPPPttttttttt
      ; Where:
      ;     s = size bit
      ;     x = X offset of sprite from centre
      ;     y = Y offset of sprite from centre
      ;     Y = Y flip
      ;     X = X flip
      ;     P = palette
      ;     p = priority (relative to background)
      ;     t = tile number
  - palettes: ...


Notes on calculating PLM position (and comparing with Samus position):

;    $0AF6: Samus X position (in pixels)
;    $0AFA: Samus Y position (in pixels)
;
;    $1C29: PLM X block (calculated by $84:8290)
;    $1C2B: PLM Y block (calculated by $84:8290)

$84:82AA 8D 2B 1C    STA $1C2B  [$7E:1C2B]
$84:82AD AD 16 42    LDA $4216  [$7E:4216]
$84:82B0 8D 29 1C    STA $1C29  [$7E:1C29]


;;; $BB6B: Pre-instruction - wake PLM if triggered or Samus is within 4 block column below PLM ;;;
{
$84:BB6B 22 90 82 84 JSL $848290[$84:8290]  ; Calculate PLM block co-ordinates
$84:BB6F AD F6 0A    LDA $0AF6  [$7E:0AF6]  ;\
$84:BB72 4A          LSR A                  ;|
$84:BB73 4A          LSR A                  ;|
$84:BB74 4A          LSR A                  ;} If [Samus X block] = [PLM X block]:
$84:BB75 4A          LSR A                  ;|
$84:BB76 CD 29 1C    CMP $1C29  [$7E:1C29]  ;|
$84:BB79 D0 10       BNE $10    [$BB8B]     ;/
$84:BB7B AD FA 0A    LDA $0AFA  [$7E:0AFA]  ;\
$84:BB7E 4A          LSR A                  ;|
$84:BB7F 4A          LSR A                  ;|
$84:BB80 4A          LSR A                  ;|
$84:BB81 4A          LSR A                  ;} If 0 <= [Samus Y block] - [PLM Y block] < 5: go to BRANCH_TRIGGERED
$84:BB82 38          SEC                    ;|
$84:BB83 ED 2B 1C    SBC $1C2B  [$7E:1C2B]  ;|
$84:BB86 C9 05 00    CMP #$0005             ;|
$84:BB89 90 05       BCC $05    [$BB90]     ;/

$84:BB8B BD 77 1D    LDA $1D77,x[$7E:1DC5]  ;\
$84:BB8E F0 13       BEQ $13    [$BBA3]     ;} If not triggered: return

; BRANCH_TRIGGERED
$84:BB90 FE 27 1D    INC $1D27,x[$7E:1D75]  ;\
$84:BB93 FE 27 1D    INC $1D27,x[$7E:1D75]  ;} PLM instruction list pointer += 2
$84:BB96 A9 01 00    LDA #$0001             ;\
$84:BB99 9F 1C DE 7E STA $7EDE1C,x[$7E:DE6A];} PLM instruction timer = 1
$84:BB9D A9 A3 BB    LDA #$BBA3             ;\
$84:BBA0 9D D7 1C    STA $1CD7,x[$7E:1D25]  ;} PLM pre-instruction = RTS

$84:BBA3 60          RTS



Mini-map notes:
- HUD GFX:
    - ROM $9A:B200
- HUD Tilemap:
    - RAM $7E:C608
    - VRAM $5820 (BG3)


Notes on game-over/loading:
- In file select, some loading happens starting at $81AD17

Notes on usage of area ($079F and $7E:D918):


Map-related usages: ---------------------------------------------------
Bank $80.asm:$80:85A7 AE 9F 07    LDX $079F  [$7E:079F]
Bank $80.asm:$80:858F AD 9F 07    LDA $079F  [$7E:079F]
	;;; $858C: Load mirror of current area's map explored ;;;

Bank $80.asm:$80:85C9 AD 9F 07    LDA $079F  [$7E:079F]
Bank $80.asm:$80:85E6 AE 9F 07    LDX $079F  [$7E:079F]
	;;; $85C6: Mirror current area's map explored ;;;

Bank $82.asm:$82:941B AD 9F 07    LDA $079F  [$7E:079F]
;;; $93C3: Updates the area and map in the map screen ;;;

Bank $82.asm:$82:9440 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9475 AE 9F 07    LDX $079F  [$7E:079F]
;;; $943D:  ;;;
   (subroutine in $93C3: Updates the area and map in the map screen ;;;)

Bank $82.asm:$82:952D AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9562 AE 9F 07    LDX $079F  [$7E:079F]
;;; $9517: Draw room select map ;;;

Bank $82.asm:$82:962B AD 9F 07    LDA $079F  [$7E:079F]
;;; $9628:  ;;;
		(???)

Bank $82.asm:$82:9ED5 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:9F01 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9EC4:  ;;;
		(???)

Bank $82.asm:$82:B6BC AD 9F 07    LDA $079F  [$7E:079F]
;;; $B672: Draw map icons ;;;

Bank $82.asm:$82:B71C AD 9F 07    LDA $079F  [$7E:079F]  ;|
Bank $82.asm:$82:B777 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $B6DD:  ;;;
	(??? - related to map icons)

Bank $82.asm:$82:B79C AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:B7BB AD 9F 07    LDA $079F  [$7E:079F]
;;; $B798: Draw save station map icon ;;;

Bank $82.asm:$82:B80E AD 9F 07    LDA $079F  [$7E:079F]
;;; $B805: Draw simple map icon ;;;
; Icons. Missile, energy, map, and debug save. X = type, A = graphic

Bank $82.asm:$82:B896 AE 9F 07    LDX $079F  [$7E:079F]
Bank $82.asm:$82:B8A2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $B892: Display map boss icons ;;;

Bank $82.asm:$82:BB3A AE 9F 07    LDX $079F  [$7E:079F]  ;\
Bank $82.asm:$82:BB46 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $BB30: Display map elevator destinations ;;;
		
Bank $90.asm:$90:A9BE AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $A91B: Update mini-map ;;;

Bank $90.asm:$90:AA73 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $90.asm:$90:AA78 6D 9F 07    ADC $079F  [$7E:079F]  ;|
;;; $AA43: Update HUD mini-map tilemap ;;;

Bank $84.asm:$84:8C91 AE 9F 07    LDX $079F  [$7E:079F]
;;; $8C8F: Instruction - activate map station ;;;

Bank $8F.asm:$8F:C90C AE 9F 07    LDX $079F  [$7E:079F]
;;; $C90A: Setup ASM: set collected map ;;;
; Room $DAAE. Tourian -> Crateria 
		(Tourian first room)

Bank $84.asm:$84:B19C AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $B18B: Setup - PLM $B6D3 (map station) ;;;
		(checking if collected current area map)

Save/load and file menu usages: ----------------------------------------
Bank $82.asm:$82:DE86 8D 9F 07    STA $079F  [$7E:079F]  ;/
;;; $DE6F: Load room header ;;;

Bank $80.asm:$80:C443 AD 9F 07    LDA $079F  [$7E:079F]
Bank $80.asm:$80:C4AC 8D 9F 07    STA $079F  [$7E:079F]
	;;; $C437: Load from load station ;;;
	(first usage to get index of save station, 
	second to set area from room header)

Bank $81.asm:$81:8023 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $81.asm:$81:8043 AD 9F 07    LDA $079F  [$7E:079F]  ;\
	;;; $8000: Save to SRAM ;;;
	(hijacked by Scyzer's patch)

Bank $81.asm:$81:80F4 8D 9F 07    STA $079F  [$7E:079F]  ;} Area index = [SRAM area index]
Bank $81.asm:$81:8123 8D 9F 07    STA $079F  [$7E:079F]  ; Region = Crateria
	;;; $8085: Load from SRAM ;;;
	(hijacked by Scyzer's patch)

Bank $81.asm:$81:9CEB 8D 9F 07    STA $079F  [$7E:079F]
;;; $9C9E: Save game menu - index 19h:  ;;;

Bank $81.asm:$81:A395 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:A3B0 EC 9F 07    CPX $079F  [$7E:079F]
;;; $A37C: File select map - index 1 ;;;

Bank $81.asm:$81:A57D AC 9F 07    LDY $079F  [$7E:079F]
;;; $A578: File select map - index 12h ;;;

Bank $81.asm:$81:A587 AC 9F 07    LDY $079F  [$7E:079F]
;;; $A582: File select map - index 3: Load area select background tilemap ;;;


Bank $81.asm:$81:A8B5 8D 9F 07    STA $079F  [$7E:079F]
Bank $81.asm:$81:A8CA 8D 9F 07    STA $079F  [$7E:079F]
Bank $81.asm:$81:A8E2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $A8A9:  ;;;
	(???)

Bank $81.asm:$81:AB1A AD 9F 07    LDA $079F  [$7E:079F]
;;; $AAAC: File select map - index 7 ;;;

Bank $81.asm:$81:AD3C 8D 9F 07    STA $079F  [$7E:079F]
;;; $AD17: File select map - index 9 ;;;

Bank $81.asm:$81:ADC0 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:ADF2 AD 9F 07    LDA $079F  [$7E:079F]
Bank $81.asm:$81:AE05 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AD7F: File select map - index Ah: room select map ;;;

Bank $81.asm:$81:AE6A AD 9F 07    LDA $079F  [$7E:079F]
;;; $AE13:  ;;;
	(???)

Bank $81.asm:$81:AFE6 AE 9F 07    LDX $079F  [$7E:079F]
Bank $81.asm:$81:AFEC AC 9F 07    LDY $079F  [$7E:079F]
;;; $AFD3: File select map - index 10h ;;;


Bank $81.asm:$81:B005 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AFF6: File select map - index 14h ;;;


Bank $82.asm:$82:8032 9C 9F 07    STZ $079F  [$7E:079F]  ; Area = Crateria
Bank $82.asm:$82:8044 8D 9F 07    STA $079F  [$7E:079F]  ;} Area = Ceres
;;; $8000: Game state 6/1Fh/28h (loading game data / set up new game / transition to demo) ;;;

Bank $82.asm:$82:86EC 8D 9F 07    STA $079F  [$8F:079F]  ;|
;;; $8679: Load demo room data ;;;


Bank $8B.asm:$8B:A39C 9C 9F 07    STZ $079F  [$7E:079F]  ; Area index = Crateria
;;; $A395: Cinematic function - intro - initial ;;;

Bank $8B.asm:$8B:C10D 8D 9F 07    STA $079F  [$7E:079F]
;;; $C100:  ;;;
		(set area to Ceres when setting up new game)


Other usages: ---------------------------------------------------
Bank $80.asm:$80:81AE AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81A6: Set boss bits in A for current area ;;;

Bank $80.asm:$80:81CA AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81C0: Unused. Clear boss bits in A for current area ;;;

Bank $80.asm:$80:81E4 AE 9F 07    LDX $079F  [$7E:079F]
	;;; $81DC: Checks if the boss bits for the current area match any bits in A ;;;

Bank $80.asm:$80:CD0D AD 9F 07    LDA $079F  [$7E:079F]  ;\
	;;; $CD07: Set elevators as used ;;;

Bank $82.asm:$82:B7D5 AD 9F 07    LDA $079F  [$7E:079F]
;;; $B7D1:  ;;;
; Debug related

Bank $82.asm:$82:B7EF AD 9F 07    LDA $079F  [$7E:079F]
;;; $B7EB:  ;;;
; Debug related

Bank $82.asm:$82:BE5C AD 9F 07    LDA $079F  [$7E:079F]
;;; $BE5A:  ;;;
; So... this routine does some stuff and then crashes?

Bank $82.asm:$82:BEC3 9C 9F 07    STZ $079F  [$7E:079F]
Bank $82.asm:$82:BEC8 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:BEE0 AE 9F 07    LDX $079F  [$7E:079F]
Bank $82.asm:$82:BEF7 AD 9F 07    LDA $079F  [$7E:079F]
Bank $82.asm:$82:BEFB 8D 9F 07    STA $079F  [$7E:079F]
;;; $BEA3:  ;;;
; So... this routine does some stuff and then crashes as well? Great!


Bank $82.asm:$82:E833 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $E7D3: Load level data, CRE, tile table, scroll data, create PLMs and execute door ASM and room setup ASM ;;;
	(just checking if Ceres)

Bank $82.asm:$82:EADB AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $EA73: Load level, scroll and CRE data ;;;
	(just checking if Ceres)

Bank $84.asm:$84:8D16 AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $8CF1: Instruction - activate save station and go to [[Y]] if [save confirmation selection] = no ;;;

Bank $84.asm:$84:B7C3 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $B7C3: Setup - PLM $B7EB (enable sounds in 20h frames, or F0h frames if on Ceres) ;;;
		(just checking if Ceres)

Bank $86.asm:$86:932F AD 9F 07    LDA $079F  [$7E:079F]
;;; $932F:  ;;;
		(something to do with Ridley's fireball -- checking if in Norfair or Tourian?)

Bank $86.asm:$86:9451 AC 9F 07    LDY $079F  [$7E:079F]
;;; $9442: Unused ;;;

Bank $86.asm:$86:AB96 AD 9F 07    LDA $079F  [$7E:079F]
;;; $AB8A: Instruction ;;;
		(checking if Crateria -- something to do with enemy drops)

Bank $89.asm:$89:AC62 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $89.asm:$89:AC98 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $AB82: Load FX header ;;;

Bank $8D.asm:$8D:EEC6 AE 9F 07    LDX $079F  [$7E:079F]  ;|
;;; $EEC5: Pre-instruction - delete palette FX object if area mini-boss is dead ;;;

Bank $8D.asm:$8D:F731 AE 9F 07    LDX $079F  [$7E:079F]  ;|
;;; $F730: Setup - palette FX object $F779 (Brinstar 8) ;;;
		(related to Spore Spawn)

Bank $90.asm:$90:EA57 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $EA45: Pause check ;;;
		(just checking if Ceres)

Bank $90.asm:$90:ED88 AD 9F 07    LDA $079F  [$7E:079F]
;;; $ED88: Footstep graphics ;;;
; Water splashing in Maridia and Crateria, dust if speedrunning.
; Only works on certain frames, assumed to be walking/running


Bank $91.asm:$91:850F AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $84D5: Pause/terminate/reset demo recorder ;;;
; Controller 2 X pauses/terminates demo recorder
; Controller 2 A resets demo recorder

Bank $91.asm:$91:CF40 AD 9F 07    LDA $079F  [$7E:079F]
;;; $CF3E:  ;;;
		(seems related to respawning speedboost block which only works in Brinstar, e.g. in dachora room)

Bank $91.asm:$91:E097 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $E00D: Initialise Samus ;;;
; Executed when loading demo or starting at Ceres/Zebes
		(just checking if Ceres)

Bank $91.asm:$91:F0A5 AD 9F 07    LDA $079F  [$7E:079F]
;;; $F0A5: Handle landing graphics ;;;

Bank $94.asm:$94:8E83 AD 9F 07    LDA $079F  [$7E:079F]
;;; $8E83: Samus block collision reaction - spike block - BTS 0 (generic spike) ;;;
; Unless already hurt, deal 60 damage (environmental) to Samus, unless in WS and Phantoon is alive


Bank $94.asm:$94:908C AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $906F: Samus block collision reaction - horizontal - special air ;;;
; Area dependant BTS

Bank $94.asm:$94:90BA AD 9F 07    LDA $079F  [$7E:079F]
;;; $909D: Samus block collision reaction - vertical - special air ;;;
		(Area dependant BTS)

Bank $94.asm:$94:90EC AD 9F 07    LDA $079F  [$7E:079F]
;;; $90CB: Samus block collision reaction - horizontal - special block ;;;
; Check BTS.
; If positive, make a PLM from the table at 9139,X (X=2*BTS, max BTS is 4F).
; If negative, make a region-indexed PLM (91D9 + 20*Area + 2*BTS, max BTS is 0F).
; If PLM fails to be made, JMP $8F49 (normal solid)

Bank $94.asm:$94:9123 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9102: Samus block collision reaction - vertical - special block ;;;
; Check BTS.
; If positive, make a PLM from the table at 9139,X (X=2*BTS, max BTS is 4F).
; If negative, make a region-indexed PLM (91D9 + 20*Area + 2*BTS, max BTS is 0F).
; If PLM fails to be made, JMP $8F82 (normal solid)

Bank $94.asm:$94:98EA AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $98EA: Block inside reaction - special air - BTS 8 (Wrecked Ship treadmill - rightwards) ;;;
		(checking if Wrecked Ship)

Bank $94.asm:$94:9910 AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $9910: Block inside reaction - special air - BTS 9 (Wrecked Ship treadmill - leftwards) ;;;

Bank $94.asm:$94:9B2F AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $9B16: Block inside reaction - special air ;;;

Bank $94.asm:$94:9D90 AD 9F 07    LDA $079F  [$7F:079F]
;;; $9D71: Block bombed reaction - special block ;;;
; Load the BTS into A.
; If negative, AND with #$007F and use to find a region-indexed PLM (94:9DC4 + Region * 10 + BTS * 2).
; If positive, use as an index for 94:9DA4,X to make a PLM.
; Either way, clear V, SEC, and RTS

Bank $94.asm:$94:9E92 AD 9F 07    LDA $079F  [$7E:079F]
;;; $9E73: Block shot/bombed/grappled reaction - shootable block ;;;
; Check BTS. If positive, create PLM from main table (94:9EA6 + BTS*2, 'max' BTS of 50).
; If negative, create region-indexed PLM (94:9F46 + 10*region + BTS*2, 'max' BTS of 10).
; Either way, clear V, SEC, RTS.

Bank $A0.asm:$A0:A7E7 AD 9F 07    LDA $079F  [$7E:079F]  ;\
Bank $A0.asm:$A0:A88D AD 9F 07    LDA $079F  [$7E:079F]  ;\
;;; $A6DE: Handles beam damage, freezing, and sound ;;;
		(checks if area is Norfair, for some reason freezing enemies works differently there?)

Bank $A4.asm:$A4:8A73 AE 9F 07    LDX $079F  [$7E:079F]
;;; $8A5A: Initialisation AI - enemy $DDBF (Crocomire) ;;;
		(checks area mini-boss bit to see if Crocomire is already dead)

Bank $A4.asm:$A4:9B90 AE 9F 07    LDX $079F  [$7E:079F]
;;; $9B86:  ;;;
		(set area mini-boss bit when Crocomire is killed)

Bank $A4.asm:$A4:F67A AE 9F 07    LDX $079F  [$7E:079F]
;;; $F67A: Initialisation AI - enemy $DDFF (Crocomire's tongue) ;;;
		(checks area mini-boss bit to see if Crocomire is already dead)

Bank $A5.asm:$A5:92D4 AE 9F 07    LDX $079F  [$7E:079F]
;;; $92AB:  ;;;
		(set area boss bit when Draygon is killed)

Bank $A5.asm:$A5:EA8F AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $EA2A: Initialisation AI - enemy $DF3F/$DF7F (Spore Spawn) ;;;
		(check area mini-boss bit to see if Spore Spawn is already dead)

Bank $A5.asm:$A5:EE30 AE 9F 07    LDX $079F  [$7E:079F]
;;; $EDF3: Spore Spawn reaction ;;;
		(set area mini-boss bit when Spore Spawn is killed)

Bank $A6.asm:$A6:A0F5 AE 9F 07    LDX $079F  [$7E:079F]
;;; $A0F5..EFB0: Ridley ;;;
;;; $A0F5: Initialisation AI - enemy $E13F/$E17F (Ridley) ;;;
		(check area boss bit to see if Ridley is dead)

Bank $A6.asm:$A6:A15C AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A369 AC 9F 07    LDY $079F  [$7E:079F]
Bank $A6.asm:$A6:A424 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A469 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:A478 AD 9F 07    LDA $079F  [$7E:079F]
;;; $A0F5..EFB0: Ridley ;;;
		(check if area is Norfair)

Bank $A6.asm:$A6:C369 AD 9F 07    LDA $079F  [$7E:079F]
;;; $C2B1: Handle typewriter text ;;;
		(check if area is Ceres)

Bank $A6.asm:$A6:D914 AD 9F 07    LDA $079F  [$7E:079F]
Bank $A6.asm:$A6:D93B AD 9F 07    LDA $079F  [$7E:079F]
;;; $D914:  ;;;
; Cause room shaking, only happens in Ceres. Has unreachable code for Norfair room shaking

Bank $A6.asm:$A6:DF8A AD 9F 07    LDA $079F  [$7E:079F]
;;; $DF8A: Enemy shot - enemy $E13F/$E17F (Ridley) ;;;
		(check if area is Norfair)

Bank $A6.asm:$A6:E4D2 AD 9F 07    LDA $079F  [$7E:079F]
;;; $E4D2: Instruction ;;;
; If in Norfair or Samus is below 30 health, go to next instruction. Else go to argument, and set main AI script timer to 8

Bank $A6.asm:$A6:F66B AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $F66A: Instruction - go to parameter if area boss is not dead ;;;
		(check if area is boss is dead -- for Ceres Ridley?)

Bank $A7.asm:$A7:A92D AE 9F 07    LDX $079F  [$7E:079F]
;;; $A92C: Check if Kraid has died ;;;

Bank $A7.asm:$A7:C822 AE 9F 07    LDX $079F  [$80:079F]  ;\
;;; $C815: Kraid function - fade in regular background - fade in BG palette 6 ;;;

Bank $A7.asm:$A7:DB7B AE 9F 07    LDX $079F  [$7E:079F]
;;; $DB3D:  ;;;
		(set boss bit when Phantoon killed)

Bank $A8.asm:$A8:CB77 AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $CB77: Initialisation AI - enemy $E8FF (Wrecked Ship robot) ;;;

Bank $A8.asm:$A8:D196 AE 9F 07    LDX $079F  [$7E:079F]  ;\
;;; $D192: Enemy shot - enemy $E8FF (Wrecked Ship robot) ;;;

Bank $A8.asm:$A8:E668 AE 9F 07    LDX $079F  [$7E:079F]
;;; $E637: Initialisation AI - enemy $EA3F (Wrecked Ship spark) ;;;

Bank $B4.asm:$B4:942D AD 9F 07    LDA $079F  [$7E:079F]  ;|
;;; $941D: Debug. Draw enemy set name ;;;